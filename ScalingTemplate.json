{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "cloudServiceName": {
            "type": "string"
        }
    },
    "variables": {
        "resourcePrefix": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Compute/cloudServices/')]"
    },
    "resources": [
        {
            "apiVersion": "2022-10-01",
            "type": "Microsoft.Insights/autoscaleSettings",
            "name": "[concat(parameters('cloudServiceName'), '-Web-Autoscale')]",
            "location": "southafricanorth",
            "properties": {
                "name": "[concat(parameters('cloudServiceName'), '-Web-Autoscale')]",
                "enabled": true,
                "targetResourceUri": "[concat(variables('resourcePrefix'), parameters('cloudServiceName'), '/roles/Web')]",
                "profiles": [
                    {
                        "name": "Default",
                        "capacity": {
                            "minimum": "1",
                            "maximum": "2",
                            "default": "1"
                        },
                        "rules": [
                            {
                                "scaleAction": {
                                    "direction": "Increase",
                                    "type": "ChangeCount",
                                    "value": "1",
                                    "cooldown": "PT10M"
                                },
                                "metricTrigger": {
                                    "metricName": "Percentage CPU",
                                    "metricNamespace": "microsoft.compute/cloudservices/roles",
                                    "metricResourceUri": "[concat(variables('resourcePrefix'), parameters('cloudServiceName'), '/roles/Web')]",
                                    "operator": "GreaterThanOrEqual",
                                    "statistic": "Average",
                                    "threshold": 80,
                                    "timeAggregation": "Average",
                                    "timeGrain": "PT1M",
                                    "timeWindow": "PT5M",
                                    "Dimensions": [],
                                    "dividePerInstance": false
                                }
                            },
                            {
                                "scaleAction": {
                                    "direction": "Decrease",
                                    "type": "ChangeCount",
                                    "value": "1",
                                    "cooldown": "PT10M"
                                },
                                "metricTrigger": {
                                    "metricName": "Percentage CPU",
                                    "metricNamespace": "microsoft.compute/cloudservices/roles",
                                    "metricResourceUri": "[concat(variables('resourcePrefix'), parameters('cloudServiceName'), '/roles/Web')]",
                                    "operator": "LessThanOrEqual",
                                    "statistic": "Average",
                                    "threshold": 20,
                                    "timeAggregation": "Average",
                                    "timeGrain": "PT1M",
                                    "timeWindow": "PT5M",
                                    "Dimensions": [],
                                    "dividePerInstance": false
                                }
                            }
                        ],
                        "recurrence": {
                            "frequency": "Week",
                            "schedule": {
                                "timeZone": "South Africa Standard Time",
                                "days": [
                                    "Monday",
                                    "Tuesday",
                                    "Wednesday",
                                    "Thursday",
                                    "Friday",
                                    "Saturday",
                                    "Sunday"
                                ],
                                "hours": [
                                    23
                                ],
                                "minutes": [
                                    0
                                ]
                            }
                        }
                    }
                ],
                "notifications": [],
                "targetResourceLocation": "southafricanorth"
            },
            "tags": {}
        }
    ]
}